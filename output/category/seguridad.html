<!DOCTYPE html>
<html lang="es">
<head>
		<title>El último recurso &mdash; Articles in Category Seguridad</title>
		<meta charset="utf-8" />
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="../theme/css/style.css" />
		<link rel='stylesheet' id='oswald-css'  href='http://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2' type='text/css' media='all' />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/atom+xml"
			title="El último recurso — Flux Atom"
			href="../" /> 
		<!--[if lte IE 8]><script src="../theme/js/html5shiv.js"></script><![endif]-->
</head>

<body class="home blog custom-background " >
	<div id="container">
		<div id="header">
				<h1 id="site-title"><a href="..">El último recurso</a></h1>
		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="../category/cajon-desastre.html">Cajón desastre</a></li>
						<li class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="../category/seguridad.html">Seguridad</a></li>
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="../category/sistemas.html">Sistemas</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
<div class="page-title">
	<h2>Filed under <span>Seguridad</span> &hellip;</h2>
</div>
		</div>
	
		<div id="contents">
<div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="../instalacion-y-configuracion-de-suricata.html">mié 12 septiembre 2018</a></div>
		<span class="byline">By <a href="../author/adrian-silva.html">Adrián Silva</a></span>
			<span class="cat-links"><a href="../category/seguridad.html" title="View all posts in Seguridad" rel="category tag">Seguridad</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="../instalacion-y-configuracion-de-suricata.html" title="Permalink to Instalación y configuración de Suricata" rel="bookmark">Instalación y configuración de Suricata</a>
		</h2>
		<div class="entry-content">
			<p><img alt="logo" src="imagenes/logo.png"></p>
<p>Suricata es una herramienta gratuita y de código libre que se ha desarrollado para controlar el tráfico de red y su principal objetivo es rastrear o buscar  eventos de seguridad que puedan indicar un ataque o posible intrusión en un servidor o en algún equipo de la red.</p>
<p>En este apartado veremos como instalar suricata desde nuestra terminal en la distribución Debian.</p>
<p>Primero debemos realizar una pre-instalación de los paquetes necesarios para su configuración.</p>
<h1>Pre-instalación</h1>
<div class="highlight"><pre><span></span>    apt-get -y install libpcre3 libpcre3-dbg libpcre3-dev \

    build-essential autoconf automake libtool libpcap-dev libnet1-dev \

    libyaml-0-2 libyaml-dev zlib1g zlib1g-dev libmagic-dev libcap-ng-dev \

    libjansson-dev pkg-config
</pre></div>


<p>De forma predeterminada, Suricata funciona como un IDS. Para utilizarlo como un programa IDS e IPS instalamos:</p>
<p><em>apt-get -y install libnetfilter-queue-dev</em></p>
<h1>Instalación</h1>
<p>Nos movemos a la carpeta deseada en la que descargaremos el paquete de suricata, lo extraemos y nos situamos en la carpeta extraida.</p>
<div class="highlight"><pre><span></span>    wget http://www.openinfosecfoundation.org/download/suricata-3.1.tar.gz

    tar -xvzf suricata-3.1.tar.gz

    cd suricata-3.1
</pre></div>


<p>Pasamos a compilar e instalar el paquete junto con las reglas.</p>
<div class="highlight"><pre><span></span>    ./configure –prefix=/usr –sysconfdir=/etc –localstatedir=/var

    make

    make install-full
</pre></div>


<p>Cuando haya acabado este proceso nos aseguramos que las siguientes carpetas se encuentran en nuestro equipo, si no las creamos.</p>
<div class="highlight"><pre><span></span>    sudo mkdir /var/log/suricata

    sudo mkdir /etc/suricata
</pre></div>


<p>Copiamos los ficheros de configuración de la carpeta que hemos extraído en la carpeta /etc/suricata.</p>
<div class="highlight"><pre><span></span>    sudo cp classification.config /etc/suricata

    sudo cp reference.config /etc/suricata

    sudo cp suricata.yaml /etc/suricata
</pre></div>


<h1>Configuración</h1>
<p>A continuación editamos el fichero suricata.yaml asegurándonos de que cada variable de los vars, grupos de direcciones y grupos de puertos en el archivo yaml está configurado correctamente respecto a nuestras necesidades.</p>
<ul>
<li>Debemos establecer la dirección ip de la red local en HOME_NET.</li>
<li>Se recomienda establecer EXTERNAL_NET en !$HOME_NET. De esta forma, cada dirección IP establecida en HOME_NET se tratará como externa.</li>
<li>HTTP_SERVERS, SMTP_SERVERS, SQL_SERVERS, DNS_SERVERS y TELNET_SERVERS se establecen de forma predeterminada en HOME_NET.</li>
<li>AIM_SERVERS se establece por defecto en ‘any’.</li>
</ul>
<p>Estas variables deben configurarse para los servidores de su red. Todos los ajustes tienen que ser configurados para que tenga un efecto más preciso.</p>
<p><img alt="1" src="imagenes/1s.png"></p>
<h1>Utilización</h1>
<p>Ejecutamos suricata mediante la siguiente expresión:</p>
<div class="highlight"><pre><span></span>suricata -c /etc/suricata/suricata.yaml -i eth0
</pre></div>


<p>Veremos algunos errores con el parseado de algunas reglas, pero una vez que se inicie el motor (engine started), estará funcionado:</p>
<p><img alt="2" src="imagenes/2s.png"></p>
<p>Las alertas se almacenan en /var/log/suricata y se crean los siguientes ficheros:</p>
<ul>
<li>fast.log</li>
<li>http.log</li>
<li>stat.log</li>
<li>alertas unified2</li>
</ul>
<p><img alt="3" src="imagenes/3s.png"></p>
<p>Si abrimos el fichero fast.log veremos una alerta que ha sido activada el 10/12/2017 a las 19.58 por la aplicación Dropbox.</p>
<p><img alt="4" src="imagenes/4s.png"></p>
<p>Por último, vamos a hacer que se envíe dicho fichero cada cierto tiempo a nuestro correo para mantener un mayor control de las alertas, para ellos necesitamos instalar:</p>
<div class="highlight"><pre><span></span>    apt-get install postfix

    apt-get install mailutils
</pre></div>


<p>Modificamos el apartado mydestination del fichero /etc/postfix/main.cf</p>
<p>En este caso como vamos a enviar el correo desde un instituto, añadimos la dirección de babuino.gonzalonazareno.org. Ponga usted la que requerida en su entorno de trabajo.</p>
<p><img alt="5" src="imagenes/5s.png"></p>
<p>Luego con el comando cat fast.log | mail -s “asunto” correoelectronico enviamos el mensaje.</p>
<p><img alt="6" src="imagenes/6s.png"></p>
<p>Pero lo aconsejable es que esta función la realice cada cierto tiempo automáticamente, por ello crearemos un script, le damos un nombre y lo ejecutamos cada 3 dias.</p>
<div class="highlight"><pre><span></span>30 19 */3 * * root /mail.sh
</pre></div>


<div class="highlight"><pre><span></span>    #! \bin\bash

    user=$(whoami)

    if [[ $user = “root” ]]

    then

    cd /var/log/suricata/

    echo “Hola, dime el correo al cual enviar las alertas de suricata”

    read correo

    if [[ $correo =~ @ ]]

    then

    echo “Asunto:”

    read asunto

    cat fast.log | mail -s “$asunto” $correo

    else

    echo “Ese correo no tiene buena pinta”

    fi

    else

    echo “Tienes que ser root, cualquiera no me va a enviar mensajes”

    fi
</pre></div>


<p><strong>Nota:</strong> Si te resulta muy complicado utilizar suricata desde la terminal puedes utilizar <a href="https://wordpress.com/read/feeds/53738596/posts/1967866159">Smooth-Sec</a>, es mucho más intutivo gracias a su interfaz gráfica.</p>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="../tag/linux.html" rel="tag">Linux</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="navigation">
</div>
		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://getpelican.com">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>